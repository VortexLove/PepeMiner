<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PepeBlackJack | Web3 Casino Platform</title>
    
    <!-- Librer칤as -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- ESTILOS VISUALES (TEMA PEPE) --- */
        :root {
            --primary: #00ff2a;
            --primary-glow: rgba(0, 255, 42, 0.5);
            --bg-dark: #05080a;
            --bg-panel: #0b1016;
            --bg-card: #121924;
            --border-color: #1f2937;
        }

        body { 
            background-color: var(--bg-dark); 
            color: white; 
            font-family: 'Inter', sans-serif; 
            overflow: hidden; /* IMPORTANTE: El scroll lo manejan los contenedores internos */
        }

        h1, h2, h3, .brand-font { font-family: 'Space Grotesk', sans-serif; }

        /* UI Utilities */
        .glass-panel { background: rgba(18, 25, 36, 0.95); border-right: 1px solid rgba(255, 255, 255, 0.05); }
        .text-neon { color: var(--primary); text-shadow: 0 0 10px var(--primary-glow); }
        
        .btn-gradient {
            background: linear-gradient(135deg, #00ff2a 0%, #009919 100%);
            color: #000; font-weight: 800; transition: 0.3s;
        }
        .btn-gradient:hover { transform: translateY(-2px); box-shadow: 0 0 20px var(--primary-glow); }

        /* --- LAYOUT GRID --- */
        .app-layout {
            display: grid;
            grid-template-columns: 260px 1fr;
            grid-template-rows: 80px 1fr;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar { grid-row: 1 / -1; z-index: 50; display: flex; flex-direction: column; }
        
        /* Header */
        .header { grid-column: 2; z-index: 40; border-bottom: 1px solid var(--border-color); background: rgba(5, 8, 10, 0.9); backdrop-filter: blur(10px); }

        /* Main Content Area */
        .content-viewport {
            grid-column: 2;
            grid-row: 2;
            position: relative;
            overflow-y: auto; /* Scroll para secciones como Home/Profile */
            background: radial-gradient(circle at 50% 20%, #1a2332 0%, #05080a 60%);
        }

        /* --- IFRAME GAME CONTAINER (INFRAESTRUCTURA CLAVE) --- */
        .game-frame-container {
            width: 100%;
            height: 100%;
            display: none; /* Oculto por defecto, se muestra al jugar */
            flex-direction: column;
        }

        .game-frame {
            width: 100%;
            flex: 1;
            border: none;
            background: transparent;
        }

        .game-toolbar {
            height: 50px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
        }

        /* Mobile */
        @media (max-width: 1024px) {
            .app-layout { grid-template-columns: 1fr; }
            .sidebar { position: fixed; transform: translateX(-100%); transition: 0.3s; height: 100vh; width: 260px; }
            .sidebar.open { transform: translateX(0); }
            .header { grid-column: 1; }
            .content-viewport { grid-column: 1; }
        }

        /* Animaciones */
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="app-layout">
        
        <!-- 1. SIDEBAR -->
        <nav id="sidebar" class="sidebar bg-panel glass-panel p-5 pt-16 lg:pt-6">
            <div class="flex items-center gap-3 mb-8 px-2 cursor-pointer" onclick="showSection('home')">
                <div class="w-10 h-10 rounded-xl bg-green-600 flex items-center justify-center text-2xl shadow-[0_0_15px_rgba(0,255,42,0.3)]">游냦</div>
                <div>
                    <h1 class="text-xl font-bold text-white leading-none">Pepe<span class="text-neon">BJ</span></h1>
                    <span class="text-[9px] text-gray-500 uppercase tracking-widest">Casino v2.0</span>
                </div>
            </div>

            <div class="space-y-1 overflow-y-auto flex-1 custom-scrollbar">
                <p class="px-3 text-[10px] font-bold text-gray-500 uppercase mt-4 mb-2">Platform</p>
                <button onclick="showSection('home')" class="w-full text-left flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 text-gray-300 hover:text-white transition">
                    <i class="fas fa-home text-blue-400"></i> Home
                </button>
                <button onclick="showSection('presale')" class="w-full text-left flex items-center gap-3 p-3 rounded-lg bg-green-900/10 border border-green-500/20 text-white font-bold transition">
                    <i class="fas fa-rocket text-neon animate-pulse"></i> PRESALE
                </button>

                <p class="px-3 text-[10px] font-bold text-gray-500 uppercase mt-6 mb-2">Games</p>
                
                <!-- BOT칍N QUE CARGA EL IFRAME -->
                <!-- BOT칍N QUE CARGA EL IFRAME -->
                
                <button onclick="loadGame('games/plinko.html', 'Plinko')" class="w-full text-left flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 text-gray-300 hover:text-white transition">
                    <i class="fas fa-caret-down text-pink-500"></i> Plinko
                </button>
                <button onclick="loadGame('games/blackjack.html', 'Blackjack')" class="w-full text-left flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 text-gray-300 hover:text-white transition">
                    <i class="fas fa-heart text-red-500"></i> Blackjack
                </button>
                <button onclick="loadGame('games/crash.html', 'Crash')" class="w-full text-left flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 text-gray-300 hover:text-white transition">
                    <i class="fas fa-rocket text-purple-500"></i> Crash
                </button>
                <button onclick="loadGame('games/mines.html', 'Mines')" class="w-full text-left flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 text-gray-300 hover:text-white transition">
                    <i class="fas fa-bomb text-yellow-500"></i> Mines
                </button>
                <button onclick="loadGame('games/dice.html', 'Dice')" class="w-full text-left flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 text-gray-300 hover:text-white transition">
                    <i class="fas fa-dice text-cyan-400"></i> Dice
                </button>

                <!-- BOT칍N QUE CARGA EL IFRAME -->
                <!-- BOT칍N QUE CARGA EL IFRAME -->
                
                <p class="px-3 text-[10px] font-bold text-gray-500 uppercase mt-6 mb-2">User</p>
                <button onclick="showSection('profile')" class="w-full text-left flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 text-gray-300 hover:text-white transition">
                    <i class="fas fa-user text-indigo-400"></i> Profile
                </button>
            </div>
            
            <div class="mt-4 bg-black/30 p-4 rounded-xl border border-white/5">
                <p class="text-[10px] text-gray-500 uppercase">Your Balance</p>
                <div class="flex items-baseline gap-1">
                    <span class="text-xl font-bold text-white" id="sidebarBalance">0.00</span>
                    <span class="text-xs text-neon font-bold">PBJ</span>
                </div>
            </div>
        </nav>

        <!-- 2. HEADER -->
        <header class="header flex items-center justify-between px-6">
            <button onclick="toggleSidebar()" class="lg:hidden text-white text-xl"><i class="fas fa-bars"></i></button>
            
            <!-- Balance Central -->
            <div class="hidden md:flex items-center bg-black/40 border border-white/10 rounded-lg px-4 py-2 cursor-pointer hover:border-neon/50 transition" onclick="showSection('presale')">
                <span class="text-sm font-bold text-white mr-2" id="headerBalance">0.00</span>
                <span class="text-xs text-neon font-bold mr-2">PBJ</span>
                <div class="w-5 h-5 rounded bg-green-500 text-black flex items-center justify-center text-xs font-bold">+</div>
            </div>

            <div class="flex gap-4 items-center">
                <!-- User Profile -->
                <div id="userInfo" class="flex items-center gap-3 bg-white/5 px-3 py-1.5 rounded-full border border-white/10 cursor-pointer" onclick="showSection('profile')">
                    <div class="text-right hidden sm:block">
                        <span class="block text-xs font-bold text-white" id="userNameDisplay">Guest</span>
                        <span class="block text-[9px] text-neon uppercase">Level 1</span>
                    </div>
                    <img id="headerAvatar" src="https://api.dicebear.com/9.x/avataaars/svg?seed=Pepe" class="w-9 h-9 rounded-full bg-black border border-white/10">
                </div>
                <button onclick="openWalletModal()" class="btn-gradient px-4 py-2 rounded-xl text-xs font-bold shadow-lg">Wallet</button>
            </div>
        </header>

        <!-- 3. VIEWPORT (DONDE PASA LA MAGIA) -->
        <main class="content-viewport custom-scrollbar">
            
            <!-- === SECCIONES HTML NORMALES (Rich Content) === -->
            
            <!-- HOME SECTION -->
            <div id="homeSection" class="max-w-7xl mx-auto p-6 md:p-10 fade-in">
                <div class="relative rounded-3xl overflow-hidden border border-white/10 p-10 mb-10 bg-gradient-to-br from-green-900/30 to-blue-900/20">
                    <div class="absolute right-0 bottom-0 opacity-20 text-9xl transform translate-x-10 translate-y-10">游냦</div>
                    <h1 class="text-5xl font-black text-white mb-4 brand-font">PLAY & EARN</h1>
                    <p class="text-gray-400 mb-6 max-w-lg">The #1 Web3 Casino on Base. Instant withdrawals, provably fair games.</p>
                    <button onclick="loadGame('games/plinko.html', 'Plinko')" class="btn-gradient px-8 py-3 rounded-xl text-black font-bold shadow-lg">PLAY PLINKO</button>
                </div>

                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2"><i class="fas fa-gamepad text-neon"></i> Featured Games</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Game Card: Plinko -->
                    <div onclick="loadGame('games/plinko.html', 'Plinko')" class="bg-card border border-white/5 rounded-2xl overflow-hidden cursor-pointer hover:border-neon hover:shadow-[0_0_20px_rgba(0,255,42,0.1)] transition group">
                        <div class="h-48 bg-gradient-to-br from-pink-600 to-purple-900 flex items-center justify-center relative">
                            <i class="fas fa-caret-down text-7xl text-white group-hover:scale-110 transition drop-shadow-lg"></i>
                            <span class="absolute top-3 right-3 bg-black/50 text-white text-[10px] px-2 py-1 rounded font-bold backdrop-blur-md">HOT</span>
                        </div>
                        <div class="p-5">
                            <h3 class="text-lg font-bold text-white">Plinko</h3>
                            <div class="flex justify-between mt-1 text-xs text-gray-500">
                                <span>Max Win: 1000x</span>
                                <span>RTP: 99%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PRESALE SECTION (Ejemplo de otra secci칩n) -->
            <div id="presaleSection" class="hidden max-w-4xl mx-auto p-10 fade-in">
                <h2 class="text-3xl font-bold text-white mb-6">Buy $PBJ Token</h2>
                <div class="bg-card p-8 rounded-2xl border border-white/10">
                    <p class="text-gray-400 mb-4">Purchase credits to play. 1 ETH = 1,000,000 PBJ.</p>
                    <input type="number" placeholder="ETH Amount" class="w-full bg-black/30 border border-white/10 p-3 rounded-lg text-white mb-4">
                    <button class="btn-gradient w-full py-3 rounded-lg font-bold">BUY CREDITS</button>
                </div>
            </div>

            <!-- PROFILE SECTION -->
            <div id="profileSection" class="hidden max-w-4xl mx-auto p-10 fade-in">
                <h2 class="text-3xl font-bold text-white mb-6">Player Profile</h2>
                <div class="bg-card p-8 rounded-2xl border border-white/10 flex items-center gap-6">
                    <img src="https://api.dicebear.com/9.x/avataaars/svg?seed=Pepe" class="w-24 h-24 rounded-full bg-black">
                    <div>
                        <h3 class="text-2xl font-bold text-white" id="profileName">User</h3>
                        <p class="text-neon">Level 5 Degen</p>
                    </div>
                </div>
            </div>

            <!-- === INFRAESTRUCTURA DE IFRAME (Aqu칤 cargan los juegos) === -->
            <div id="gameContainer" class="game-frame-container fade-in">
                <!-- Barra de herramientas del juego -->
                <div class="game-toolbar">
                    <button onclick="showSection('home')" class="text-gray-400 hover:text-white flex items-center gap-2 text-sm font-bold">
                        <i class="fas fa-arrow-left"></i> Back to Lobby
                    </button>
                    <span id="activeGameTitle" class="ml-4 text-white font-bold opacity-50">| Game</span>
                    <div class="ml-auto text-xs text-gray-500 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> Live
                    </div>
                </div>
                <!-- El Iframe -->
                <iframe id="gameFrame" class="game-frame" src="about:blank" allow="autoplay"></iframe>
            </div>

        </main>
    </div>

    <!-- MODAL WALLET -->
    <div id="walletModal" class="fixed inset-0 bg-black/90 z-[100] hidden flex items-center justify-center backdrop-blur-sm">
        <div class="bg-card p-6 rounded-2xl border border-white/10 w-80 text-center">
            <h3 class="text-xl font-bold text-white mb-4">Connect Wallet</h3>
            <button onclick="connectWalletMock()" class="w-full p-3 bg-white/5 hover:bg-white/10 rounded-lg text-white mb-2">MetaMask</button>
            <button onclick="document.getElementById('walletModal').classList.add('hidden')" class="text-gray-500 text-sm mt-2">Close</button>
        </div>
    </div>

    <script>
        // --- ESTADO GLOBAL (SINGLE SOURCE OF TRUTH) ---
        const STORAGE_KEY = 'pepeblackjack_v2';
        let state = {
            balance: 1000.00,
            user: 'Guest',
            avatar: 'https://api.dicebear.com/9.x/avataaars/svg?seed=Pepe'
        };

        // --- INICIALIZACI칍N ---
        window.onload = () => {
            loadState();
            updateUI();
        };

        function loadState() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) state = { ...state, ...JSON.parse(stored) };
        }

        function saveState() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            updateUI();
        }

        function updateUI() {
            const fmt = state.balance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('sidebarBalance').innerText = fmt;
            document.getElementById('headerBalance').innerText = fmt;
            document.getElementById('userNameDisplay').innerText = state.user;
            document.getElementById('headerAvatar').src = state.avatar;
        }

        // --- SISTEMA DE NAVEGACI칍N SPA ---
        function showSection(id) {
            // Ocultar iframe
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('gameFrame').src = 'about:blank'; // Liberar memoria
            
            // Ocultar secciones
            ['homeSection', 'presaleSection', 'profileSection'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });

            // Mostrar secci칩n deseada
            document.getElementById(id + 'Section').classList.remove('hidden');
            
            // Cerrar men칰 m칩vil si est치 abierto
            document.getElementById('sidebar').classList.remove('open');
        }

        // --- INFRAESTRUCTURA DE JUEGO (IFRAME LOADER) ---
        function loadGame(url, title) {
            // 1. Ocultar secciones HTML
            ['homeSection', 'presaleSection', 'profileSection'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });

            // 2. Mostrar contenedor del juego
            const container = document.getElementById('gameContainer');
            container.style.display = 'flex';
            document.getElementById('activeGameTitle').innerText = `| ${title}`;

            // 3. Cargar Iframe
            const frame = document.getElementById('gameFrame');
            frame.src = url;

            // 4. Sincronizar saldo al cargar
            frame.onload = () => {
                frame.contentWindow.postMessage({ type: 'INIT_BALANCE', balance: state.balance }, '*');
            };

            // Cerrar men칰 m칩vil
            document.getElementById('sidebar').classList.remove('open');
        }

        // --- COMUNICACI칍N PADRE <-> HIJO (POSTMESSAGE) ---
        window.addEventListener('message', (event) => {
            const data = event.data;

            // Seguridad: Verificar origen si estuvieras en dominios distintos
            // if (event.origin !== "http://tusitio.com") return;

            if (data.type === 'UPDATE_BALANCE') {
                // El juego reporta una apuesta (negativo) o ganancia (positivo)
                // data.amount debe ser float
                
                // Actualizar estado global
                state.balance += data.amount;
                saveState(); // Persistir en LocalStorage

                // Confirmar nuevo saldo al juego para que su UI se actualice
                const frame = document.getElementById('gameFrame');
                if(frame && frame.contentWindow) {
                    frame.contentWindow.postMessage({ type: 'SYNC_BALANCE', balance: state.balance }, '*');
                }
            }
        });

        // --- UTILS ---
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function openWalletModal() { document.getElementById('walletModal').classList.remove('hidden'); }
        function connectWalletMock() {
            state.user = "0xDeGE...888";
            state.balance += 500; // Bono demo
            saveState();
            document.getElementById('walletModal').classList.add('hidden');
            Swal.fire({toast: true, position: 'top-end', icon: 'success', title: 'Wallet Connected', background: '#121924', color:'#fff'});
        }
    </script>
</body>
</html>
